# GoReleaser v2 é€šç”¨é…ç½®æ–‡ä»¶
# æ–‡æ¡£: https://goreleaser.com
version: 2

# é¡¹ç›®åŸºæœ¬ä¿¡æ¯
project_name: "xiaomi-router-shell-enabler"

# æ„å»ºå‰æ‰§è¡Œçš„å‘½ä»¤
before:
  hooks:
    # æ¸…ç†æ¨¡å—ç¼“å­˜
    - go mod tidy
    # è¿è¡Œæµ‹è¯•ï¼ˆå¯é€‰ï¼Œæ ¹æ®éœ€è¦å–æ¶ˆæ³¨é‡Šï¼‰
    # - go test -v ./...

# æ„å»ºé…ç½®
builds:
  - id: default
    # ä¸»å…¥å£æ–‡ä»¶
    main: ./
    # äºŒè¿›åˆ¶æ–‡ä»¶å
    binary: "{{ .ProjectName }}"
    # ç¯å¢ƒå˜é‡
    env:
      - CGO_ENABLED=0
    # æ”¯æŒçš„æ“ä½œç³»ç»Ÿ
    goos:
      - linux
      - darwin
      - windows
      - freebsd
    # æ”¯æŒçš„æ¶æ„
    goarch:
      - amd64
      - arm64
      - arm
      - "386"
    # ARM ç‰ˆæœ¬
    goarm:
      - "6"
      - "7"
    # å¿½ç•¥çš„ç»„åˆ
    ignore:
      - goos: windows
        goarch: arm
      - goos: windows
        goarch: arm64
      - goos: darwin
        goarch: arm
      - goos: darwin
        goarch: "386"
      - goos: freebsd
        goarch: arm
    # ç¼–è¯‘æ ‡å¿—
    flags:
      - -trimpath
    # é“¾æ¥å™¨æ ‡å¿—ï¼ˆæ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯ï¼‰
    ldflags:
      - -s -w
      - -X github.com/bamzest/xiaomi-router-shell-enabler/pkg/version.Version={{.Version}}
      - -X github.com/bamzest/xiaomi-router-shell-enabler/pkg/version.BuildTime={{.Date}}
      - -X github.com/bamzest/xiaomi-router-shell-enabler/pkg/version.GitCommit={{.Commit}}
    # ä¿®æ”¹æ—¶é—´è®¾ç½®ï¼ˆæé«˜å¯é‡ç°æ€§ï¼‰
    mod_timestamp: "{{ .CommitTimestamp }}"

# é€šç”¨æ„å»ºé€‰é¡¹
gomod:
  proxy: true

# æ‰“åŒ…é…ç½®
archives:
  - id: default
    # å½’æ¡£æ–‡ä»¶åæ ¼å¼
    name_template: >-
      {{ .ProjectName }}_
      {{- .Version }}_
      {{- .Os }}_
      {{- if eq .Arch "amd64" }}x86_64
      {{- else if eq .Arch "386" }}i386
      {{- else }}{{ .Arch }}{{ end }}
      {{- if .Arm }}v{{ .Arm }}{{ end }}
    # åŒ…å«çš„æ–‡ä»¶
    files:
      - README.md
      - LICENSE*
      # - CHANGELOG.md
      # - config.example.yml
      # - docs/**/*

# é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¸å‹ç¼©ï¼‰
# é€‚ç”¨äºéœ€è¦ç›´æ¥ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶çš„åœºæ™¯
nfpms:
  - id: default
    package_name: "{{ .ProjectName }}"
    vendor: "bamzest"
    homepage: "https://github.com/bamzest/{{ .ProjectName }}"
    maintainer: "bamzest"
    description: "å°ç±³è·¯ç”±å™¨Shellå¯ç”¨å·¥å…· - å¯ç”¨SSHå’ŒTelnetè®¿é—®"
    license: "AGPL-3.0-or-later"
    # æ”¯æŒçš„æ ¼å¼
    formats:
      - deb
      - rpm
      - apk

# æ ¡éªŒå’Œ
checksum:
  name_template: "checksums.txt"
  algorithm: sha256

# æºä»£ç å½’æ¡£
source:
  enabled: true
  name_template: "{{ .ProjectName }}_{{ .Version }}_source"
  format: tar.gz

# å¿«ç…§ç‰ˆæœ¬é…ç½®ï¼ˆç”¨äºéæ ‡ç­¾æ„å»ºï¼‰
snapshot:
  version_template: "{{ incpatch .Version }}-next"

# å˜æ›´æ—¥å¿—é…ç½®
changelog:
  sort: asc
  use: github
  filters:
    exclude:
      - "^docs:"
      - "^test:"
      - "^ci:"
      - "^chore:"
      - "^style:"
      - "Merge pull request"
      - "Merge branch"
  groups:
    - title: "âœ¨ æ–°åŠŸèƒ½"
      regexp: '^.*?feat(\([[:word:]]+\))??!?:.+$'
      order: 0
    - title: "ğŸ› Bug ä¿®å¤"
      regexp: '^.*?fix(\([[:word:]]+\))??!?:.+$'
      order: 1
    - title: "âš¡ æ€§èƒ½ä¼˜åŒ–"
      regexp: '^.*?perf(\([[:word:]]+\))??!?:.+$'
      order: 2
    - title: "â™»ï¸ ä»£ç é‡æ„"
      regexp: '^.*?refactor(\([[:word:]]+\))??!?:.+$'
      order: 3
    - title: "ğŸ“š æ–‡æ¡£æ›´æ–°"
      regexp: '^.*?docs(\([[:word:]]+\))??!?:.+$'
      order: 4
    - title: "ğŸ”§ å…¶ä»–å˜æ›´"
      order: 999

# GitHub Release é…ç½®
release:
  # GitHub é…ç½®
  github:
    owner: "bamzest"
    name: "xiaomi-router-shell-enabler"
  # æ˜¯å¦åˆ›å»ºè‰ç¨¿
  draft: false
  # æ˜¯å¦æ ‡è®°ä¸ºé¢„å‘å¸ƒ
  prerelease: auto
  # æ¨¡å¼ï¼ˆç”¨äºæ›¿æ¢ç°æœ‰ releaseï¼‰
  mode: append
  # Release è¯´æ˜æ¨¡æ¿
  header: |
    ## ğŸ‰ {{ .ProjectName }} {{ .Tag }} å‘å¸ƒ
    **å‘å¸ƒæ—¶é—´**: {{ .Date }}
    
    æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„ä»˜å‡ºï¼
  footer: |
    ---
    ### ğŸ“¦ å®‰è£…æ–¹æ³•
    
    **äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½**ï¼šä»ä¸Šæ–¹ Assets ä¸‹è½½å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…
    
    **ä½¿ç”¨ Go å®‰è£…**:
    ```bash
    go install github.com/bamzest/{{ .ProjectName }}@{{ .Tag }}
    ```
    
    **å®Œæ•´å˜æ›´æ—¥å¿—**: https://github.com/bamzest/{{ .ProjectName }}/compare/{{ .PreviousTag }}...{{ .Tag }}

# å…¬å‘Šé…ç½®ï¼ˆv2 æ–°å¢ï¼‰
announce:
  skip: "{{ gt .Patch 0 }}"  # è·³è¿‡è¡¥ä¸ç‰ˆæœ¬çš„å…¬å‘Š

# å…ƒæ•°æ®
metadata:
  mod_timestamp: "{{ .CommitTimestamp }}"